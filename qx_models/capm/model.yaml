model:
  id: capm_model
  version: 1.0.0
  featureset_id: ohlcv_v1+rf_v1
  description: "CAPM expected return using daily OHLCV and daily risk-free"

inputs:
  - name: equity_prices
    required: true
    type:
      domain: market-data
      asset_class: equity
      subdomain: bars
      subtype: null
      region: null
      frequency: null # Accept any frequency (will be resampled to target frequency)
    description: "OHLCV price data (will be resampled to monthly if needed)"
  - name: risk_free
    required: true
    type:
      domain: reference-rates
      asset_class: fixed-income
      subdomain: yield-curves
      subtype: null
      region: null
      frequency: null # Accept any frequency (will be resampled to target frequency)
    description: "Risk-free rates (will be resampled to monthly if needed for excess returns)"

output:
  # Dataset identity
  type:
    domain: derived-metrics
    asset_class: equity
    subdomain: expected-returns
    subtype: capm
    region: null
    frequency: monthly

  # Schema definition
  schema:
    schema_version: schema_v1

    columns:
      - name: symbol
        type: string
        description: Stock ticker symbol
        required: true
        filterable: true
        filter_type: in

      - name: date
        type: date
        description: Forecast date (monthly)
        required: true
        filterable: true
        filter_type: range

      - name: beta_market
        type: float
        description: Market beta (from regression)
        required: true
        filterable: false

      - name: rf_rate
        type: float
        description: Risk-free rate (monthly)
        required: true
        filterable: false

      - name: market_premium
        type: float
        description: Market risk premium (monthly)
        required: true
        filterable: false

      - name: ER_monthly
        type: float
        description: Expected return (monthly)
        required: true
        filterable: true
        filter_type: range

      - name: ER_annual
        type: float
        description: Expected return (annualized)
        required: true
        filterable: true
        filter_type: range

      # Metadata columns (auto-added by BaseModel)
      - name: model
        type: string
        description: Model ID (auto-added by BaseModel)
        required: true
        filterable: true
        filter_type: exact

      - name: model_version
        type: string
        description: Model version (auto-added by BaseModel)
        required: true
        filterable: true
        filter_type: exact

      - name: featureset_id
        type: string
        description: Input featureset ID (auto-added by BaseModel)
        required: true
        filterable: true
        filter_type: exact

      - name: run_id
        type: string
        description: Run identifier (auto-added by BaseModel)
        required: true
        filterable: true
        filter_type: exact

      - name: run_ts
        type: datetime
        description: Run timestamp (auto-added by BaseModel)
        required: true
        filterable: true
        filter_type: range

    partition_keys:
      - date

    filters:
      date:
        type: date
        description: Filter by forecast date

    path_template: "data/processed/{domain}/{asset_class}/{subdomain}/{subtype}/date={date}/part-{run_id}.parquet"

parameters:
  horizon_d:
    type: int
    default: 252
    min: 1
    max: 2520
  beta_method:
    type: enum
    default: "simple"
    allowed: ["simple", "rolling_ols", "exponential"]

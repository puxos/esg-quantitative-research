builder:
  id: sp500_membership_builder
  version: 1.0.0
  description: "S&P 500 historical membership builder - transforms raw CSV into curated daily membership data"

# ==============================================================================
# OUTPUT CONTRACT (unified from schema_daily.yaml and schema_intervals.yaml)
# ==============================================================================
output:
  # Dataset type (shared by both modes)
  dataset:
    domain: instrument-reference
    asset_class: null
    subdomain: index-constituents
    region: null
    frequency: null

  # Schema definitions (mode-specific)
  schemas:
    daily:
      version: schema_v1
      description: "Point-in-time membership tracking (date, ticker pairs)"
      required_columns:
        - name: date
          dtype: datetime64[ns]
          description: Observation date
        - name: ticker
          dtype: object
          description: Stock ticker symbol

    intervals:
      version: schema_v1
      description: "Interval-based membership tracking (ticker, start_date, end_date)"
      required_columns:
        - name: ticker
          dtype: object
          description: Stock ticker symbol
        - name: start_date
          dtype: datetime64[ns]
          description: Membership start date (inclusive)
        - name: end_date
          dtype: datetime64[ns]
          description: Membership end date (inclusive)

  # Partitioning (shared)
  partition_keys:
    - universe
    - mode

  # Path template (shared)
  path_template: data/curated/{domain}/{subdomain}/{schema_version}/universe={universe}/mode={mode}

# ==============================================================================
# BUILDER PARAMETERS
# ==============================================================================
parameters:
  min_date:
    type: string
    default: "2000-01-01"
    description: "Minimum date to include in curated output (ISO format YYYY-MM-DD)"

  raw_data_root:
    type: string
    default: "./raw"
    description: "Root directory for raw data files (relative to package)"

  membership_filename:
    type: string
    default: "S&P 500 Historical Components & Changes(11-16-2025).csv"
    description: "Name of the raw CSV file"

  write_mode:
    type: enum
    default: "overwrite"
    allowed: ["append", "overwrite"]
    description: "Write mode - overwrite deletes existing files, append keeps them"

# ==============================================================================
# PARTITION REQUIREMENTS
# ==============================================================================
partitions:
  required:
    - universe
    - mode

  defaults:
    universe: sp500
    mode: daily

# ==============================================================================
# YAML Structure Clarification
# ==============================================================================
# This YAML follows a clear separation of concerns:
#
# 1. `inputs`: Curated datasets required (resolved via DatasetType contracts)
#    - These are persistent datasets from the data lake
#    - Loaded via TypedCuratedLoader with type safety
#    - Example: membership data, OHLCV prices, ESG scores
#
# 2. `parameters`: Configuration values (not datasets)
#    - These are runtime config: dates, thresholds, flags
#    - Provided via `overrides` when invoking the task
#    - Example: start_date, end_date, universe name
#
# 3. `runtime_dependencies` (optional): Task outputs from other tasks
#    - NOT curated datasets, but outputs from loaders/tasks in the DAG
#    - Used when a task needs results from another task's execution
#    - Example: A builder needs symbol list from a loader task
#    - Note: Most tasks don't need this - it's for special cases
#
# 4. `output`: What this task produces
#    - For loaders: in-memory objects (List, Dict, DataFrame)
#    - For builders: curated datasets (persisted to data lake)
#    - For models: processed datasets (persisted to processed layer)
# ==============================================================================

loader:
  id: historic_members_loader
  version: 1.0.0
  description: "Get all symbols that were members of a universe during a period (including removed members)"

# Curated datasets required (resolved via DatasetType contracts)
inputs:
  - name: membership_data
    required: true
    type:
      domain: instrument-reference
      subdomain: index-constituents
    description: "Membership interval data"

# Configuration parameters (not datasets)
parameters:
  start_date:
    type: str
    required: true
    description: "Period start date (YYYY-MM-DD)"
    example: "2014-01-01"

  end_date:
    type: str
    required: true
    description: "Period end date (YYYY-MM-DD)"
    example: "2024-12-31"

  universe:
    type: str
    default: "sp500"
    description: "Universe identifier"
    allowed: ["sp500", "russell1000", "nasdaq100"]

  use_ticker_mapper:
    type: bool
    default: true
    description: |
      Whether to consolidate ticker changes to current symbols.
      If true: Maps old tickers to current ones (FB â†’ META)
      If false: Returns all ticker symbols as-is (both FB and META)
    notes: |
      When enabled, companies that changed tickers will appear only once
      under their current ticker. Useful for:
      - Counting unique companies (not unique ticker symbols)
      - Avoiding duplicate positions in portfolios
      - Data fetching (Tiingo migrates data to new tickers)

# Optional: Runtime dependencies (task outputs, not curated datasets)
# runtime_dependencies:
#   - task_id: "BuildMembershipIntervals"
#     description: "Requires membership intervals to be built first"
# Note: This loader doesn't need runtime_dependencies because it reads
# from curated data (declared in `inputs`), not from task outputs.

# Output specification (with validation rules)
output:
  type: list
  item_type: str
  description: |
    List of ticker symbols that were members at ANY point during the period.
    Eliminates survivorship bias by including:
    - Current members
    - Removed members (delisted, acquired, merged)
    - Stocks that joined and left during the period
  example: ["AAPL", "MSFT", "GOOGL", "FOX", "TWX", ...]

  # Validation rules (enforced at runtime)
  validation:
    allow_empty: false  # Must have at least one symbol
    min_length: 1
    max_length: 5000  # Sanity check: universe shouldn't exceed 5000 symbols
    item_pattern: "^[A-Z0-9.\\-]+$"  # Valid ticker format
